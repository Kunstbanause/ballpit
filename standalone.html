<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ball x Pit</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        const jsonData = {
          "evolutions": [
            {
              "name": "Vampire Lord",
              "ingredients": ["Bleed", "Vampire"],
              "category": "Bleed",
              "description": "Each hit inflicts 3 stacks of bleed. Heals 1 health and consumes all stacks when hitting an enemy with at least 10 stacks of bleed"
            },
            {
              "name": "Leech",
              "ingredients": ["Bleed", "Brood Mother"],
              "category": "Bleed",
              "description": "Attaches up to 1 leech onto enemies it hits, which adds 2 stacks of bleed per second (max 24 stacks)"
            },
            {
              "name": "Virus",
              "ingredients": ["Bleed", "Poison"],
              "category": "Bleed",
              "description": "Applies 1 stack of disease to units it hits (max 8 stacks). Disease lasts for 6 seconds. Each stack of disease deals 3-6 damage per second and diseased units have a 15% chance of passing a stack to undiseased nearby enemies each second"
            },
            {
              "name": "Berserk",
              "ingredients": ["Bleed", "Charm"],
              "category": "Bleed",
              "description": "Each hit has a 30% chance of causing enemies to go berserk for 6 seconds. Berserk enemies deal 15-24 damage to adjacent enemies every second"
            },
            {
              "name": "Sacrifice",
              "ingredients": ["Bleed", "Dark"],
              "category": "Bleed",
              "description": "Inflicts 4 stacks of bleed (max 15 stacks) and applies curse to hit enemies. Cursed enemies are dealt 50-100 after being hit 5 times"
            },
            {
              "name": "Hemorrhage",
              "ingredients": ["Bleed", "Iron"],
              "category": "Bleed",
              "description": "Inflicts 3 stacks of bleed. When hitting an enemy with 12 stacks of bleed or more, consume all stacks of bleed to deal 20% of their current health"
            },
            {
              "name": "Leech",
              "ingredients": ["Brood Mother", "Bleed"],
              "category": "Brood Mother",
              "description": "Attaches up to 1 leech on to enemies it hits, which adds 2 stacks of bleed per second (max 24 stacks)"
            },
            {
              "name": "Maggot",
              "ingredients": ["Brood Mother", "Cell"],
              "category": "Brood Mother",
              "description": "Infest enemies on hit with maggots. When they die, they explode into 1-2 baby balls"
            },
            {
              "name": "Spider Queen",
              "ingredients": ["Brood Mother", "Egg Sac"],
              "category": "Brood Mother",
              "description": "Has a 25% chance of birthing an Egg Sac each time it hits an enemy"
            },
            {
              "name": "Mosquito King",
              "ingredients": ["Brood Mother", "Vampire"],
              "category": "Brood Mother",
              "description": "Spawns a mosquito each time it hits an enemy. Mosquitos attack a random enemy, dealing 80-120 damage each. If a mosquito kills an enemy, they steal 1 health"
            },
            {
              "name": "Bomb",
              "ingredients": ["Burn", "Iron"],
              "category": "Burn",
              "description": "Explodes when hitting an enemy, dealing 150-300 damage to nearby enemies. Has a 3-second cooldown before it can be shot again"
            },
            {
              "name": "Magma",
              "ingredients": ["Burn", "Earthquake"],
              "category": "Burn",
              "description": "Emits lava blobs over time. Enemies who walk into lava blobs are dealt 15-30 damage and gain 1 stack of burn (max 3 stacks). Burn lasts for 3 seconds, dealing 3-8 damage per stack per second. This ball and its lava blobs also deal 6-12 damage to nearby units"
            },
            {
              "name": "Inferno",
              "ingredients": ["Burn", "Wind"],
              "category": "Burn",
              "description": "Applies 1 stack of burn every second to all enemies within a 2 tile radius. Burn lasts for 6 seconds, dealing 3-7 damage per stack per second"
            },
            {
              "name": "Berserk",
              "ingredients": ["Burn", "Charm"],
              "category": "Burn",
              "description": "Each hit has a 30% chance of causing enemies to go berserk for 6 seconds. Berserk enemies deal 15-24 damage to adjacent enemies every second"
            },
            {
              "name": "Sun",
              "ingredients": ["Burn", "Light"],
              "category": "Burn",
              "description": "Blind all enemies in view and add 1 stack of burn every second (max 5 stacks). Burn lasts for 6 seconds and deals 6-12 damage per stack per second"
            },
            {
              "name": "Frozen Flame",
              "ingredients": ["Burn", "Freeze"],
              "category": "Burn",
              "description": "Add 1 stack of frostburn on hit for 20 seconds (max 4 stacks). Frostburnt units are dealt 8-12 damage per stack per second and receive 25% more damage from other sources"
            },
            {
              "name": "Maggot",
              "ingredients": ["Cell", "Brood Mother"],
              "category": "Cell",
              "description": "Infest enemies on hit with maggots. When they die, they explode into 1-2 baby balls"
            },
            {
              "name": "Overgrowth",
              "ingredients": ["Cell", "Earthquake"],
              "category": "Cell",
              "description": "Applies 1 stack of overgrowth. Upon reaching 3, consume all stacks and deal 0-200 damage to all enemies in a 3x3 tile square"
            },
            {
              "name": "Radiation Beam",
              "ingredients": ["Cell", "Laser"],
              "category": "Cell",
              "description": "Emit a radiation beam on hit that deals 24-48 damage and applies 1 stack of radiation (max 5 stacks). Radiation lasts for 15 seconds and causes enemies to receive 10% more damage from all sources per stack"
            },
            {
              "name": "Voluptuous",
              "ingredients": ["Cell", "Egg Sac"],
              "category": "Cell",
              "description": "Explodes into 2-3 egg sacs on hitting an enemy. Has a 3-second cooldown before it can be shot again"
            },
            {
              "name": "Virus",
              "ingredients": ["Cell", "Poison"],
              "category": "Cell",
              "description": "Applies 1 stack of disease to units it hits (max 8 stacks). Disease lasts for 6 seconds. Each stack of disease deals 3-6 damage per second and diseased units have a 15% chance of passing a stack to undiseased nearby enemies each second"
            },
            {
              "name": "Succubus",
              "ingredients": ["Charm", "Vampire"],
              "category": "Charm",
              "description": "Each hit has a 4% chance of charming the enemy for 9 seconds. Heals 1 when hitting a charmed enemy"
            },
            {
              "name": "Berserk",
              "ingredients": ["Charm", "Burn"],
              "category": "Charm",
              "description": "Each hit has a 30% chance of causing enemies to go berserk for 6 seconds. Berserk enemies deal 15-24 damage to adjacent enemies every second"
            },
            {
              "name": "Incubus",
              "ingredients": ["Charm", "Dark"],
              "category": "Charm",
              "description": "Each hit has a 4% chance of charming the enemy for 9 seconds. Charmed enemies curse nearby enemies. Cursed enemies are dealt 100-200 after being hit 5 times"
            },
            {
              "name": "Lovestruck",
              "ingredients": ["Charm", "Light"],
              "category": "Charm",
              "description": "Inflicts lovestruck on hit enemies for 20 seconds. Lovestruck units have a 50% chance of healing you for 5 health when they attack"
            },
            {
              "name": "Vampire Lord",
              "ingredients": ["Dark", "Vampire"],
              "category": "Dark",
              "description": "Each hit inflicts 3 stacks of bleed. Heals 1 health and consumes all stacks when hitting an enemy with at least 10 stacks of bleed"
            },
            {
              "name": "Assassin",
              "ingredients": ["Dark", "Iron"],
              "category": "Dark",
              "description": "Passes through the front of enemies, but not the back. Backstabs deal 30% bonus damage"
            },
            {
              "name": "Phantom",
              "ingredients": ["Dark", "Ghost"],
              "category": "Dark",
              "description": "Curse enemies on hit. Cursed enemies are dealt 100-200 damage after being hit 5 times"
            },
            {
              "name": "Sacrifice",
              "ingredients": ["Dark", "Bleed"],
              "category": "Dark",
              "description": "Inflicts 4 stacks of bleed (max 15 stacks) and applies curse on hit to enemies. Cursed enemies are dealt 50-100 after being hit 5 times"
            },
            {
              "name": "Incubus",
              "ingredients": ["Dark", "Charm"],
              "category": "Dark",
              "description": "Each hit has a 4% chance of charming the enemy for 9 seconds. Charmed enemies curse nearby enemies. Cursed enemies are dealt 100-200 after being hit 5 times"
            },
            {
              "name": "Black Hole",
              "ingredients": ["Dark", "Sun"],
              "category": "Dark",
              "description": "Instantly kills the first non-boss enemy that it hits, but destroys itself afterwards. Has a 7-second cooldown before it can be shot again"
            },
            {
              "name": "Nixious",
              "ingredients": ["Dark", "Wind"],
              "category": "Dark",
              "description": "Passes through enemies and applies 3 stacks of poison to nearby enemies within a 2 tile radius. Poison lasts for 4 seconds and each stack deals 1-3 damage per second"
            },
            {
              "name": "Flicker",
              "ingredients": ["Dark", "Light"],
              "category": "Dark",
              "description": "Deals 1-7 damage to every enemy on screen ever 1.4 seconds"
            },
            {
              "name": "Magma",
              "ingredients": ["Earthquake", "Burn"],
              "category": "Earthquake",
              "description": "Emits lava blobs over time. Enemies who walk into lava blobs are dealt 15-30 damage and gain 1 stack of burn (max 3 stacks). Burn lasts for 3 seconds, dealing 3-8 damage per stack per second. This ball and its lava blobs also deal 6-12 damage to nearby units"
            },
            {
              "name": "Swamp",
              "ingredients": ["Earthquake", "Poison"],
              "category": "Earthquake",
              "description": "Leaves behind tar blobs over time. Enemies who walk into tar blobs are dealt 15-30, are slowed by 50% for 7 seconds and gain 1 stack of poison (max 8 stacks). Each stack of poison deals 1-3 damage per second. This ball and its tar blobs also deal 6-12 damage to nearby units"
            },
            {
              "name": "Glacier",
              "ingredients": ["Earthquake", "Freeze"],
              "category": "Earthquake",
              "description": "Releases glacial spikes over time that deal 15-30 damage to enemies that touch them and freeze them for 2.0 seconds. This ball and its glacial spikes also deal 6-12 damage to nearby units"
            },
            {
              "name": "Sandstorm",
              "ingredients": ["Earthquake", "Wind"],
              "category": "Earthquake",
              "description": "Goes through enemies and is surrounded by a raging storm dealing 10-20 damage per second and blinding nearby enemies for 3 seconds"
            },
            {
              "name": "Overgrowth",
              "ingredients": ["Earthquake", "Cell"],
              "category": "Earthquake",
              "description": "Applies 1 stack of overgrowth. Upon reaching 3, consume all stacks and deal 0-200 damage to all enemies in a 3x3 tile square"
            },
            {
              "name": "Spider Queen",
              "ingredients": ["Egg Sac", "Brood Mother"],
              "category": "Egg Sac",
              "description": "Has a 25% chance of birthing an Egg Sac each time it hits an enemy"
            },
            {
              "name": "Mosquito Swarm",
              "ingredients": ["Egg Sac", "Vampire"],
              "category": "Egg Sac",
              "description": "Explodes into 3-6 mosquitoes. Mosquitos attack random enemies, dealing 80-120 damage each. If a mosquito kills an enemy, they steal 1 health"
            },
            {
              "name": "Shotgun",
              "ingredients": ["Egg Sac", "Iron"],
              "category": "Egg Sac",
              "description": "Shoots 3-7 iron baby balls after hitting a wall. Iron baby balls move at 200% speed but are destroyed upon hitting anything"
            },
            {
              "name": "Voluptuous Egg Sac",
              "ingredients": ["Egg Sac", "Cell"],
              "category": "Egg Sac",
              "description": "Explodes into 2-3 egg sacs on hitting an enemy. Has a 3-second cooldown before it can be shot again"
            },
            {
              "name": "Wraith",
              "ingredients": ["Freeze", "Ghost"],
              "category": "Freeze",
              "description": "Freezes any enemy it passes through for 0.8 seconds"
            },
            {
              "name": "Blizzard",
              "ingredients": ["Freeze", "Lightning"],
              "category": "Freeze",
              "description": "Freezes all enemies within a 2 tile radius for 0.8 seconds, dealing 1-50 damage"
            },
            {
              "name": "Freeze Ray",
              "ingredients": ["Freeze", "Laser"],
              "category": "Freeze",
              "description": "Emits a freeze ray when hitting an enemy, dealing 20-50 to all enemies in its path, with a 10% chance of freezing them for 10.0 seconds"
            },
            {
              "name": "Frozen Flame",
              "ingredients": ["Freeze", "Burn"],
              "category": "Freeze",
              "description": "Add 1 stack of frostburn on hit for 20 seconds (max 4 stacks). Frostburnt units are dealt 8-12 damage per stack per second and receive 25% more damage from other sources"
            },
            {
              "name": "Glacier",
              "ingredients": ["Freeze", "Earthquake"],
              "category": "Freeze",
              "description": "Releases glacial spikes over time that deal 15-30 to enemies that touch them and freeze them for 2.0 seconds. This ball and its glacial spikes also deal 6-12 damage to nearby units"
            },
            {
              "name": "Wraith",
              "ingredients": ["Ghost", "Freeze"],
              "category": "Ghost",
              "description": "Freezes any enemy it passes through for 0.8 seconds"
            },
            {
              "name": "Assassin",
              "ingredients": ["Ghost", "Iron"],
              "category": "Ghost",
              "description": "Passes through the front of enemies, but not the back. Backstabs deal 30% bonus damage"
            },
            {
              "name": "Virus",
              "ingredients": ["Ghost", "Poison"],
              "category": "Ghost",
              "description": "Applies 1 stack of disease to units it hits (max 8 stacks). Disease lasts for 6 seconds. Each stack of disease deals 3-6 damage per second and diseased units have a 15% chance of passing a stack to undiseased nearby enemies each second"
            },
            {
              "name": "Phantom",
              "ingredients": ["Ghost", "Dark"],
              "category": "Ghost",
              "description": "Curse enemies on hit. Cursed enemies are dealt 100-200 damage after being hit 5 times"
            },
            {
              "name": "Soul Sucker",
              "ingredients": ["Ghost", "Vampire"],
              "category": "Ghost",
              "description": "Passes through enemies and saps them, with a 30% chance of stealing 1 health and reducing their attack damage by 20%. Lifesteal chance only applies once per enemy"
            },
            {
              "name": "Bomb",
              "ingredients": ["Iron", "Burn"],
              "category": "Iron",
              "description": "Explodes when hitting an enemy, dealing 150-300 damage to nearby enemies. Has a 3-second cooldown before it can be shot again"
            },
            {
              "name": "Assassin",
              "ingredients": ["Iron", "Ghost"],
              "category": "Iron",
              "description": "Passes through the front of enemies, but not the back. Backstabs deal 30% bonus damage"
            },
            {
              "name": "Lightning Rod",
              "ingredients": ["Iron", "Lightning"],
              "category": "Iron",
              "description": "Plants a lightning rod into enemies it hits. These enemies are struck by lightning every 3.0 seconds, dealing 1-30 damage to up to 8 nearby enemies"
            },
            {
              "name": "Shotgun",
              "ingredients": ["Iron", "Egg Sac"],
              "category": "Iron",
              "description": "Shoots 3-7 iron baby balls after hitting a wall. Iron baby balls move at 200% speed but are destroyed upon hitting anything"
            },
            {
              "name": "Hemorrhage",
              "ingredients": ["Iron", "Bleed"],
              "category": "Iron",
              "description": "Inflicts 3 stacks of bleed. When hitting an enemy with 12 stacks of bleed or more, consumes all stacks of bleed to deal 20% of their current health"
            },
            {
              "name": "Holy Laser",
              "ingredients": ["Laser (Horizontal)", "Laser (Vertical)"],
              "category": "Laser",
              "description": "Deals 24-36 damage to all enemies in the same row and column"
            },
            {
              "name": "Freeze Ray",
              "ingredients": ["Laser", "Freeze"],
              "category": "Laser",
              "description": "Emits a freeze ray when hitting an enemy, dealing 20-50 to all enemies in its path, with a 10% chance of freezing them for 10.0 seconds"
            },
            {
              "name": "Laser Beam",
              "ingredients": ["Laser", "Light"],
              "category": "Laser",
              "description": "Emit a laser beam on hit that deals 30-42 damage and blinds enemies for 8 seconds"
            },
            {
              "name": "Radiation Beam",
              "ingredients": ["Laser", "Cell"],
              "category": "Laser",
              "description": "Emit a radiation beam on hit that deals 24-48 damage and applies 1 stack of radiation (max 5 stacks). Radiation lasts for 15 seconds and cause enemies to receive 10% more damage from all sources per stack"
            },
            {
              "name": "Sun",
              "ingredients": ["Light", "Burn"],
              "category": "Light",
              "description": "Blind all enemies in view and add 1 stacks of burn every second (max 5 stacks). Burn lasts for 6 seconds and deals 6-12 damage per stack per second"
            },
            {
              "name": "Laser Beam",
              "ingredients": ["Light", "Laser"],
              "category": "Light",
              "description": "Emit a laser beam on hit that deals 30-42 damage and blinds enemies for 8 seconds"
            },
            {
              "name": "Flash",
              "ingredients": ["Light", "Lightning"],
              "category": "Light",
              "description": "Damage all enemies on screen for 1-3 damage after hitting an enemy and blind them for 2 seconds"
            },
            {
              "name": "Flicker",
              "ingredients": ["Light", "Dark"],
              "category": "Light",
              "description": "Deals 1-7 damage to every enemy on screen every 1.4 seconds"
            },
            {
              "name": "Lovestruck",
              "ingredients": ["Light", "Charm"],
              "category": "Light",
              "description": "Inflict lovestruck on hit to enemies for 20 seconds. Lovestruck units have a 50% chance of healing you for 5 health when they attack"
            },
            {
              "name": "Lightning Rod",
              "ingredients": ["Lightning", "Iron"],
              "category": "Lightning",
              "description": "Plants a lightning rod into enemies it hits. These enemies are struck by lightning every 3.0 seconds, dealing 1-30 damage to up to 8 nearby enemies"
            },
            {
              "name": "Blizzard",
              "ingredients": ["Lightning", "Freeze"],
              "category": "Lightning",
              "description": "Freezes all enemies within a 2 tile radius for 0.8 seconds, dealing 1-50 damage"
            },
            {
              "name": "Flash",
              "ingredients": ["Lightning", "Light"],
              "category": "Lightning",
              "description": "Damage all enemies on screen for 1-3 damage after hitting an enemy and blind them for 2 seconds"
            },
            {
              "name": "Storm",
              "ingredients": ["Lightning", "Wind"],
              "category": "Lightning",
              "description": "Emits lightning to strike nearby enemies every second, dealing 1-40 damage"
            },
            {
              "name": "Lovestruck",
              "ingredients": ["Lightning", "Charm"],
              "category": "Lightning",
              "description": "Inflicts lovestruck on hit enemies for 20 seconds. Lovestruck units have a 50% chance of healing you for 5 health when they attack"
            },
            {
              "name": "Swamp",
              "ingredients": ["Poison", "Earthquake"],
              "category": "Poison",
              "description": "Leaves behind tar blobs over time. Enemies who walk into tar blobs are dealt 15-30, are slowed by 50% for 7 seconds and gain 1 stack of poison (max 8 stacks). Each stack of poison deals 1-3 damage per second. This ball and its tar blobs also deal 6-12 damage to nearby units"
            },
            {
              "name": "Nuclear Bomb",
              "ingredients": ["Poison", "Bomb"],
              "category": "Poison",
              "description": "Explodes when hitting an enemy, dealing 300-500 damage to nearby enemies and applying 1 stack of radiation to everyone present indefinitely (max 5 stacks). Each stack of radiation increases damage received by 10%. Has a 3-second cooldown"
            },
            {
              "name": "Virus",
              "ingredients": ["Poison", "Ghost"],
              "category": "Poison",
              "description": "Applies 1 stack of disease to units it hits (max 8 stacks). Disease lasts for 6 seconds. Each stack of disease deals 3-6 damage per second and diseased units have a 15% chance of passing a stack to undiseased nearby enemies each second"
            },
            {
              "name": "Radiation Beam",
              "ingredients": ["Poison", "Laser"],
              "category": "Poison",
              "description": "Emit a radiation beam on hit that deals 24-48 damage and applies 1 stack of radiation (max 5 stacks). Radiation lasts for 15 seconds and cause enemies to receive 10% more damage from all sources per stack"
            },
            {
              "name": "Noxious",
              "ingredients": ["Poison", "Wind"],
              "category": "Poison",
              "description": "Passes through enemies and applies 3 stacks of poison to nearby enemies within a 2 tile radius. Poison lasts for 4 seconds and each stack deals 1-3 damage per second"
            },
            {
              "name": "Vampire Lord",
              "ingredients": ["Vampire", "Bleed"],
              "category": "Vampire",
              "description": "Each hit inflicts 3 stacks of bleed. Heals 1 health and consumes all stacks when hitting an enemy with at least 10 stacks of bleed"
            },
            {
              "name": "Mosquito Swarm",
              "ingredients": ["Vampire", "Egg Sac"],
              "category": "Vampire",
              "description": "Explode into 3-6 mosquitoes. Mosquitos attack random enemies, dealing 80-120 damage each. If a mosquito kills an enemy, they steal 1 health"
            },
            {
              "name": "Mosquito King",
              "ingredients": ["Vampire", "Brood Mother"],
              "category": "Vampire",
              "description": "Spawns a mosquito each time it hits an enemy. Mosquitos attack a random enemy, dealing 80-120 damage each. If a mosquito kills an enemy, they steal 1 health"
            },
            {
              "name": "Succubus",
              "ingredients": ["Vampire", "Charm"],
              "category": "Vampire",
              "description": "Each hit has a 4% chance of charming the enemy for 9 seconds. Heals 1 when hitting a charmed enemy"
            },
            {
              "name": "Soul Sucker",
              "ingredients": ["Vampire", "Ghost"],
              "category": "Vampire",
              "description": "Passes through enemies and saps them, with a 30% chance of stealing 1 health and reducing their attack, damage by 20%. Lifesteal chance only applies once per enemy"
            },
            {
              "name": "Blizzard",
              "ingredients": ["Wind", "Freeze"],
              "category": "Wind",
              "description": "Freezes all enemies within a 2 tile radius for 0.8 seconds, dealing 1-50 damage"
            },
            {
              "name": "Inferno",
              "ingredients": ["Wind", "Burn"],
              "category": "Wind",
              "description": "Applies 1 stack of burn every second to all enemies within a 2 tile radius. Burn lasts for 6 seconds, dealing 3-7 damage per stack per second"
            },
            {
              "name": "Storm",
              "ingredients": ["Wind", "Lightning"],
              "category": "Lightning",
              "description": "Emits lightning to strike nearby enemies every second, dealing 1-40 damage"
            },
            {
              "name": "Noxious",
              "ingredients": ["Wind", "Poison"],
              "category": "Wind",
              "description": "Passes through enemies and applies 3 stacks of poison to nearby enemies within a 2 tile radius. Poison lasts for 4 seconds and each stack deals 1-3 damage per second"
            },
            {
              "name": "Sandstorm",
              "ingredients": ["Wind", "Earthquake"],
              "category": "Wind",
              "description": "Goes through enemies and is surrounded by a raging storm dealing 10-20 damage per second and blinding nearby enemies for 3 seconds"
            },
            {
              "name": "Satan",
              "ingredients": ["Succubus", "Incubus"],
              "category": "Special",
              "description": "While active, add 1 stack of burn to all active enemies per second (max 5 stacks), dealing 10-20 damage per stack per second and make them go berserk, dealing 15-24 damage to adjacent enemies every second"
            },
            {
              "name": "Nosferatu",
              "ingredients": ["Vampire Lord", "Spider Queen", "Mosquito King"],
              "category": "Special",
              "description": "Spawns a vampire bat each bounce. Vampire bats fly towards a random enemy, dealing 132-176 damage on hit, turning into a Vampire Lord"
            }
          ]
        };

        function BallEvolutionGraph() {
          const [selectedBall, setSelectedBall] = useState(null);
          const [hoveredNode, setHoveredNode] = useState(null);

          const { evolutions, baseElements, nameMap } = useMemo(() => {
            const data = jsonData;
            const newNameMap = {};
            const allNames = new Set();
            data.evolutions.forEach(e => {
                allNames.add(e.name);
                e.ingredients.forEach(i => allNames.add(i));
            });
            allNames.forEach(name => newNameMap[name.toUpperCase().replace(/\s/g, ' ')] = name);

            const evos = data.evolutions.map(e => ({
                ...e,
                name: e.name.toUpperCase().replace(/\s/g, ' '),
                ingredients: e.ingredients.map(i => i.toUpperCase().replace(/\s/g, ' '))
            }));

            const evoNames = new Set(evos.map(e => e.name));
            const allIngredients = new Set(evos.flatMap(e => e.ingredients));
            const base = [...allIngredients].filter(ing => !evoNames.has(ing));

            return { evolutions: evos, baseElements: base.sort(), nameMap: newNameMap };
          }, []);

          const getColor = (element) => {
            const colors = {
              'BLEED': '#dc2626', 'BROOD MOTHER': '#9333ea', 'BURN': '#ea580c', 'CELL': '#16a34a', 'CHARM': '#db2777',
              'DARK': '#1f2937', 'EARTHQUAKE': '#b45309', 'EGG SAC': '#65a30d', 'FREEZE': '#0891b2', 'GHOST': '#475569',
              'IRON': '#64748b', 'LASER': '#eab308', 'LASER (HORIZONTAL)': '#eab308', 'LASER (VERTICAL)': '#eab308',
              'LIGHT': '#facc15', 'LIGHTNING': '#4f46e5', 'POISON': '#059669', 'VAMPIRE': '#be185d', 'WIND': '#0369a1',
            };
            if (evolutions) {
                const evoColorSource = evolutions.find(e => e.name === element);
                if (evoColorSource) return colors[evoColorSource.ingredients[0]] || '#6b7280';
            }
            return colors[element] || '#6b7280';
          };

          const getIconSlug = (name) => {
            if (!name) return '';
            return name.toLowerCase().replace(/ /g, '-').replace(/[^a-z0-9-]/g, '');
          };

          const getIconUrls = (name) => {
            const slug = getIconSlug(name);
            if (!slug) return [];
            return [`icons/${slug}.png`];
          };

          const uniqueEvos = useMemo(() => {
            if (!evolutions) return [];
            const seen = new Set();
            const result = [];
            evolutions.forEach(evo => {
              const key = evo.name;
              if (!seen.has(key)) {
                seen.add(key);
                result.push(evo);
              }
            });
            return result;
          }, [evolutions]);

          const baseWidth = 140;
          const baseHeight = 45;
          const rowSpacing = 80;
          const evoSpacing = 60;

          const { positions, svgWidth, svgHeight } = useMemo(() => {
            if (!uniqueEvos || !baseElements) return { positions: {}, svgWidth: 1400, svgHeight: 900 };
            
            const levels = {};
            let maxLevel = 0;
            baseElements.forEach(b => levels[b] = 0);

            let changed = true;
            while (changed) {
              changed = false;
              uniqueEvos.forEach(evo => {
                if (levels[evo.name] !== undefined) return;
                const ingredientLevels = evo.ingredients.map(ing => levels[ing]);
                if (ingredientLevels.some(l => l === undefined)) return;
                const maxIngredientLevel = Math.max(...ingredientLevels);
                levels[evo.name] = maxIngredientLevel + 1;
                if (levels[evo.name] > maxLevel) maxLevel = levels[evo.name];
                changed = true;
              });
            }
            
            uniqueEvos.forEach(evo => {
                if (levels[evo.name] === undefined) {
                    levels[evo.name] = maxLevel + 1;
                }
            });

            const positions = {};
            const columnWidth = baseWidth + 100;
            
            baseElements.forEach((element, idx) => {
              positions[element] = { x: 40, y: 50 + idx * rowSpacing };
            });

            let totalHeight = 50 + baseElements.length * rowSpacing;

            for (let level = 1; level <= maxLevel + 1; level++) {
              const nodesInLevel = Object.keys(levels).filter(name => levels[name] === level);
              const nodesWithTargetY = nodesInLevel.map(name => {
                const evo = uniqueEvos.find(e => e.name === name) || { ingredients: [] };
                const ingredientPositions = evo.ingredients.map(ing => positions[ing]).filter(p => p);
                let targetY = 0;
                if (ingredientPositions.length > 0) {
                  targetY = ingredientPositions.reduce((sum, p) => sum + p.y, 0) / ingredientPositions.length;
                }
                return { name, targetY };
              });

              nodesWithTargetY.sort((a, b) => a.targetY - b.targetY);

              let lastYInColumn = 0;
              nodesWithTargetY.forEach(({ name, targetY }) => {
                const x = 40 + level * columnWidth;
                const y = Math.max(targetY, lastYInColumn + evoSpacing);
                positions[name] = { x, y };
                lastYInColumn = y;
              });
              if (lastYInColumn > totalHeight) totalHeight = lastYInColumn;
            }

            const newSvgWidth = 40 + (maxLevel + 1) * columnWidth + baseWidth + 40;
            return { positions, svgWidth: newSvgWidth, svgHeight: totalHeight + baseHeight };
          }, [uniqueEvos, baseElements]);

          const getAncestors = (ballName, allEvolutions) => {
            const ancestors = new Set();
            const toProcess = [ballName];
            const processed = new Set();

            while(toProcess.length > 0) {
                const currentBall = toProcess.pop();
                if (processed.has(currentBall)) continue;
                processed.add(currentBall);

                const recipes = allEvolutions.filter(e => e.name === currentBall);
                recipes.forEach(recipe => {
                    recipe.ingredients.forEach(ing => {
                        ancestors.add(ing);
                        toProcess.push(ing);
                    });
                });
            }
            return ancestors;
        };

        const getDescendants = (ballName, allEvolutions) => {
            const descendants = new Set();
            const toProcess = [ballName];
            const processed = new Set();

            while(toProcess.length > 0) {
                const currentBall = toProcess.pop();
                if (processed.has(currentBall)) continue;
                processed.add(currentBall);

                const children = allEvolutions.filter(e => e.ingredients.includes(currentBall));
                children.forEach(child => {
                    descendants.add(child.name);
                    toProcess.push(child.name);
                });
            }
            return descendants;
        };

        const highlightedChain = useMemo(() => {
            if (!selectedBall || !evolutions) return new Set();
            const ancestors = getAncestors(selectedBall, evolutions);
            const descendants = getDescendants(selectedBall, evolutions);
            const chain = new Set([...ancestors, ...descendants, selectedBall]);
            return chain;
        }, [selectedBall, evolutions]);

          const NodeContent = ({ name, pos, nameMap }) => {
            const displayName = nameMap[name] || name;
            const urls = getIconUrls(displayName);
            const imgSize = 36;
            const padding = 5;
            const imgX = pos.x + padding;
            const imgY = pos.y + (baseHeight - imgSize) / 2;
            const primary = urls[0];
            
            const textX = pos.x + padding + imgSize + padding;
            const textY = pos.y + baseHeight / 2;

            const wrapText = (text) => {
                const maxCharsPerLine = 15;
                if (text.length <= maxCharsPerLine) return [text];
                const words = text.split(' ');
                const lines = [];
                let currentLine = '';
                for(const word of words) {
                    if ((currentLine + ' ' + word).trim().length > maxCharsPerLine && currentLine.length > 0) {
                        lines.push(currentLine);
                        currentLine = word;
                    } else {
                        currentLine = (currentLine + ' ' + word).trim();
                    }
                }
                if (currentLine) lines.push(currentLine);
                return lines;
            };
            const lines = wrapText(displayName);

            return (
                <g>
                    {primary && (
                        <image
                            href={primary} x={imgX} y={imgY} width={imgSize} height={imgSize}
                            preserveAspectRatio="xMidYMid slice"
                            onError={(e) => { e.target.style.display = 'none'; }}
                            className="pointer-events-none select-none"
                        />
                    )}
                    <text
                        x={textX}
                        y={textY - (lines.length > 1 ? (lines.length - 1) * 6 : 0)}
                        textAnchor="start"
                        dominantBaseline="middle"
                        fontSize={displayName.length > 15 ? "10" : "11"}
                        fontWeight="bold"
                        fill="white"
                        className="pointer-events-none select-none"
                    >
                        {lines.map((line, i) => (
                            <tspan key={i} x={textX} dy={i === 0 ? 0 : '1.2em'}>{line}</tspan>
                        ))}
                    </text>
                </g>
            );
        };

          const [searchTerm, setSearchTerm] = useState('');

          const allNodeNames = useMemo(() => {
            if (!baseElements || !evolutions) return [];
            const evoNames = new Set(evolutions.map(e => e.name));
            const allNames = new Set([...baseElements, ...evoNames]);
            return Array.from(allNames).sort();
          }, [evolutions, baseElements]);

          const searchResults = useMemo(() => {
            if (!searchTerm || !allNodeNames) return [];
            return allNodeNames
              .filter(name => (nameMap[name] || name).toLowerCase().includes(searchTerm.toLowerCase()))
              .slice(0, 10);
          }, [searchTerm, allNodeNames, nameMap]);


          const activeNode = selectedBall || hoveredNode;
          const recipesForActiveNode = useMemo(() => {
            if (!activeNode || !evolutions) return [];
            return evolutions
              .filter(evo => evo.name === activeNode)
              .map(evo => evo.ingredients.map(ing => nameMap[ing] || ing).join(' + '));
          }, [activeNode, evolutions, nameMap]);

          const descriptionForActiveNode = useMemo(() => {
            if (!activeNode || !evolutions) return '';
            const evo = evolutions.find(e => e.name === activeNode);
            return evo ? evo.description : '';
          }, [activeNode, evolutions]);

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-950 p-6">
              <div className="max-w-full">
                <h1 className="text-4xl font-bold text-white mb-2">Ball x Pit Ballz</h1>
                <div className="relative mb-4 max-w-md">
                  <input
                    type="text"
                    placeholder="Search for a ball..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full bg-slate-700 text-white placeholder-slate-400 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  {searchResults.length > 0 && (
                    <div className="absolute z-10 w-full mt-1 bg-slate-800 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto">
                      {searchResults.map(name => (
                        <div key={name} onClick={() => { setSelectedBall(name); setSearchTerm(''); }} className="px-4 py-2 text-white hover:bg-slate-700 cursor-pointer">
                          {nameMap[name] || name}
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                <div className="relative">
                  <div className="bg-slate-800 rounded-lg overflow-y-auto overflow-x-auto" style={{ maxHeight: '80vh' }}>
                    <svg
                      width={svgWidth}
                      height={svgHeight}
                      viewBox={`0 0 ${svgWidth} ${svgHeight}`}
                      className="bg-slate-700"
                      style={{ minHeight: '900px', display: 'block' }}
                    >
                      <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
                          <polygon points="0 0, 10 3, 0 6" fill="#94a3b8" />
                        </marker>
                      </defs>

                      {uniqueEvos.map((evo, idx) => {
                        const endPos = positions[evo.name];
                        if (!endPos) return null;

                        return evo.ingredients.map((ing, ingIdx) => {
                          const startPos = positions[ing];
                          if (!startPos) return null;
                          
                          const isHighlighted = highlightedChain.has(evo.name) && highlightedChain.has(ing);

                          return (
                            <line
                              key={`line-${idx}-${ingIdx}`}
                              x1={startPos.x + baseWidth}
                              y1={startPos.y + baseHeight / 2}
                              x2={endPos.x}
                              y2={endPos.y + baseHeight / 2}
                              stroke={isHighlighted ? '#3b82f6' : '#64748b'}
                              strokeWidth={isHighlighted ? 2 : 1}
                              markerEnd="url(#arrowhead)"
                              opacity={!selectedBall ? 0.4 : (isHighlighted ? 1 : 0.3)}
                              className="transition-all"
                            />
                          );
                        });
                      })}

                      {baseElements.map((element) => {
                        const pos = positions[element];
                        if (!pos) return null;
                        const isSelected = selectedBall === element;
                        const isInChain = highlightedChain.has(element);

                        return (
                          <g key={`base-${element}`}>
                            <rect
                              x={pos.x} y={pos.y} width={baseWidth} height={baseHeight} rx="4"
                              fill={getColor(element)}
                              stroke={isSelected ? '#fff' : isInChain ? '#3b82f6' : 'none'}
                              strokeWidth={isSelected ? 2 : isInChain ? 1.5 : 0}
                              opacity={!selectedBall || isInChain ? 1 : 0.3}
                              className="cursor-pointer transition-all hover:opacity-100"
                              onClick={() => setSelectedBall(selectedBall === element ? null : element)}
                              onMouseEnter={() => setHoveredNode(element)}
                              onMouseLeave={() => setHoveredNode(null)}
                            />
                            <NodeContent name={element} pos={pos} nameMap={nameMap} />
                          </g>
                        );
                      })}

                      {uniqueEvos.map((evo, idx) => {
                          const pos = positions[evo.name];
                          if (!pos) return null;
                          const isSelected = selectedBall === evo.name;
                          const isInChain = highlightedChain.has(evo.name);

                          return (
                            <g key={`evo-${evo.name}-${idx}`}>
                              <rect
                                x={pos.x} y={pos.y} width={baseWidth} height={baseHeight} rx="4"
                                fill={getColor(evo.name)}
                                stroke={isSelected ? '#fff' : isInChain ? '#3b82f6' : 'none'}
                                strokeWidth={isSelected ? 2 : isInChain ? 1.5 : 0}
                                opacity={!selectedBall || isInChain ? 1 : 0.3}
                                className="cursor-pointer transition-all hover:opacity-100"
                                onClick={() => setSelectedBall(selectedBall === evo.name ? null : evo.name)}
                                onMouseEnter={() => setHoveredNode(evo.name)}
                                onMouseLeave={() => setHoveredNode(null)}
                              />
                              <NodeContent name={evo.name} pos={pos} nameMap={nameMap} />
                            </g>
                          );
                      })}
                    </svg>
                  </div>

                  {activeNode && (
                    <div className="absolute bottom-2 left-2 z-10 bg-slate-900/75 backdrop-blur-sm rounded-lg p-4 max-w-md">
                      <h3 className="text-white mb-2">
                          <span className="font-semibold">{(nameMap[activeNode] || activeNode)}</span>
                          {descriptionForActiveNode && <span className="font-normal">{`: ${descriptionForActiveNode}`}</span>}
                      </h3>
                      {recipesForActiveNode.length > 0 ? (
                        <div className="text-slate-300 text-sm">
                          {recipesForActiveNode.join('; ')}
                        </div>
                      ) : null}
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<BallEvolutionGraph />, document.getElementById('root'));
    </script>
</body>
</html>